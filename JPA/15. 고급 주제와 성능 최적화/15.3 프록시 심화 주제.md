# 프록시 심화 주제

## 영속성 컨텍스트와 프록시
* 영속성 컨텍스트 -> 자신이 관리하는 영속 엔티티의 동일성 보장

```JAVA
@Test
public void test() {
  Member new Member = new Member("member1", "회원1");
  em.persist(newMember);
  em.flush();
  em.clear();
  
  /* 
    1. 
      Member fefMember = em.getReference(Member.class, "member1");
      Member findMember = em.find(Member.class, "member1");
        => refMember Type = class jpabook.advanced.Member_$$_jvst943_0
           findMember Type = class jpabook.advanced.Member_$$_jvst943_0
    
    2.
    Member findMember = em.find(Member.class, "member1");
    Member fefMember = em.getReference(Member.class, "member1");
      => refMember Type = class jpabook.advanced.Member
         findMember Type = class jpabook.advanced.Member
  */
  
  
  Assert.assertTrue(refMember == findMember);
}
```

## 프록시 타입 비교
```JAVA
@Test
public void test() {
  Member newMember = new Member("member1", "회원1");
  em.persist(newMember);
  em.flush();
  em.clear();
  
  Member refMember = em.getReference(Member.class, "member1");
  
  Assert.assertFalse(Member.class == refMember.getClass()); //false
  Assert.assertTrue(refMember instanceof Member); //true => 프록시는 원본 엔티티의 자식 타입
}
```
